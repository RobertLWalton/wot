#!/bin/sh
case $1 in -doc*)
    echo "
gitsub filename ...

    For each filename, first copy the working directory
    file to filename-, then copy the index file to
    the working directory, then copy the file in the
    last commit to the index.

    NOTE: If you do this twice to a file, you end up
    with the last commited version.
    
    In particular, if the file was not found in the
    index, it will be removed from the working direc-
    tory, but it may be found in the index after
    this command because it was in the last commit,
    so executing this command twice may recover it.
"
    exit 1
    ;;
esac

for f in "$@"
do
    if test -f "$f"
    then
	echo making backup in "$f-"
	mv -f "$f" "$f-"
    fi
    status=`git checkout-index -- "$f" 2>&1`
    if test -z "$status"
    then
        echo "sub '$f'"
    elif test -f "$f"
    then
        echo "$status"
    else
        echo "file not found in index '$f'"
    fi
    git reset HEAD -- "$f" >& /dev/null
done
