#!/bin/sh
#
# File:		gitdiff
# Author:	Bob Walton <walton@acm.org>
# Date:		Tue Jul 24 03:05:48 EDT 2012
#
# The author(s) have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.

case "$1" in -doc*)
    echo "
gitdiff [ {m} | ~m ] [ {n} | ~n ] [-a | filename ...]
    Lists differences between the working versions of
    files and either a previous committed version of the
    files or the last gitadd'ed versions.

    With no argument, does this for all files in the
    current directory and its subdirectories.  With -a
    argument, for all files in all repository director-
    ies.  Otherwise only for the listed files.

    With no commit name argument, diffs working versions
    with the last gitadd'ed version if that exists, or
    the last committed version otherwise.  With one
    commit name, diffs the working version with the
    version in the commit.  With two commit names, diffs
    the versions in the two commits."

    exit 1
    ;;

{*})
    src="$1"
    commit="HEAD@$1"
    shift
    ;;

~*)
    src="$1"
    commit="HEAD$1"
    shift
    ;;

*)
    src=index
    commit=""
    ;;
esac

case "$1" in

{*})
    dst="$1"
    commit="$commit HEAD@$1"
    shift
    ;;

~*)
    dst="$1"
    commit="$commit HEAD$1"
    shift
    ;;

*)
    dst=working
    ;;
esac

case "$1" in

"")
    git diff --src-prefix="$src"/ \
             --dst-prefix="$dst"/ \
             $commit .
    ;;
"-a")
    git diff --src-prefix="$src"/ \
             --dst-prefix="$dst"/ \
             $commit
    ;;
*)
    git diff --src-prefix="$src"/ \
             --dst-prefix="$dst"/ \
             $commit -- "$@"
    ;;
esac
