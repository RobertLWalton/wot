#!/bin/sh
#
# SPE server program.
#
# File:		spe-server
# Author:	Bob Walton (walton@deas.harvard.edu)
# Date:		Fri Jan 30 20:18:33 EST 2004
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# RCS Info (may not be true date or author):
#
#   $Author: walton $
#   $Date: 2004/01/31 01:19:50 $
#   $RCSfile: calendar,v $
#   $Revision: 1.3 $
#
# The next line starts tclsh \
exec tclsh "$0" "$@"

# set month = {m1 m2 m3 m4} and day = {d1 d2 d3 d4}
# where m1/d1 is today, m2/d2 tommorrow, m3/d3 the
# day after tommorrow, etc.
#
set time [clock seconds]
set month {}
set day {}
set count 1
while { $count <= 4 } {
    set date [clock format $time -format "%m %d"]
    set m [lindex $date 0]
    regexp {^0*([1-9].*)$} $m forget m
    set d [lindex $date 1]
    regexp {^0*([1-9].*)$} $d forget d
    lappend month $m
    lappend day $d
    incr time [expr 24 * 60 * 60]
    incr count
}

# Go through the lines of stdin printing those with
# a date matching one of those listed in month/day.
#
while { "yes" } {

    set line [gets stdin]
    if { [eof stdin] } break
    regsub -all "\[ \t,/\]+" $line " " items
    set last ""
    foreach item [split $items " "] {
	regexp {^0*([1-9].*)$} $item forget item
	set index [lsearch -exact $day $item]
        if { $index < 0 } {
	    set last $item
	    continue
	}

	set last [string tolower $last]
	set len [string length $last]
	set lenm1 [expr $len - 1]
	if {    [regexp {^[a-z]*$} $last] \
	     && $len >= 3 } {
	    set m 1
	    foreach mon { january february march \
	    		  april may june \
			  july august sepember \
			  october november december \
			} {
	        if {    [string range $mon 0 $lenm1] \
		     == $last } {
		    set last $m
		    break
		}
		incr m
	    }
	}

	regexp {^0*([1-9].*)$} $last forget last
        if { $last == [lindex $month $index] } {
	    puts $line
	}
	set last $item
    }
}
