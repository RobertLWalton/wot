#!/bin/sh
#
# File:		gitpullinto
# Author:	Bob Walton <walton@acm.org>
# Date:		Sun Oct 18 08:23:33 EDT 2015
#
# The author(s) have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.


case $1 in -doc*)
    echo "
gitpullinto repository
    Pull all the commits from the given repository into
    the current repository.  It is assumed that the
    files in the given repository are not in the current
    repository.  All the commits in the given repository
    are redone in the current repository.

    The current repository must have an origin and be
    sync'ed with its origin, so that if anything goes
    wrong the current repository can be deleted and
    recovered from its origin.  This is checked first,
    and if not the case, gitpullinto complains and
    aborts."

    exit 1
    ;;
esac

stat=`git status --porcelain -uno`
if test "$stat" != ""
then
    echo There are uncommitted files:
    echo "$stat"
    echo Commit before pull.
    echo Aborting.
    exit 1
fi

git fetch "$1"
git checkout -q $FETCH_HEAD
git rebase master
git branch -d master
git branch master
git checkout master
